# 多源站优先级设置

阿里云CDN支持三种类型回源域名：OSS回源域名、IP和自定义域名。其中IP和自定义域名支持多IP或多域名设置，可在多源站场景下，进行回源优先级设置。

当用户选择的回源源站类型为IP或自定义域名时，可设置多个源站，并为多源站设置优先级。添加多源站时，源站优先级为**主**和**备**，优先级为**主**\>**备**。

所有回源流量首先回源优先级高的源站。如果某个源站健康检查连续3次失败，所有流量将选择优先级第二的源站回源。如果主动健康检查成功，该源站会重新标记为可用，恢复原来的优先级。所有源站的回源优先级一样时，CDN将自动轮询回源。

源站健康检查：采用主动四层健康检查机制，每2.5秒主动健康检查一次。

**说明：**

多源优先级设置只支持IP和源站域名类型。您可根据实际需求，选择适合自己的源站类型，设置合理的优先级。直播加速不支持源站设置。

当存在多个主源站或备源站时，会按照概率决定访问其中一个主源站或备源站。访问情况会按照概率随机进行，例如：配置有3个主源站，在90次请求中，每个主源站都会有30次被请求。

1.  登录[视频点播控制台](https://vod.console.aliyun.com/)。

2.  在点播控制台左侧导航栏选择**配置管理**。

3.  单击**分发加速配置** \> **域名管理**，进入域名管理页面。

4.  选择您要配置的域名，单击**配置**。

    ![配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1277415061/p180549.png)

5.  单击**基础配置**，选择**源站信息**，单击**修改配置**。

    ![修改配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1951106061/p184328.png)

6.  设置源站类型、源站地址和端口。

    ![配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1951106061/p184329.png)

    -   如果选择的源站信息为IP或源站域名，则按照外网流量标准进行计费。

    -   如果选择的源站信息为OSS域名，即从CDN回源OSS，则按照内网价格计费，请参见 [OSS价格详情](https://cn.aliyun.com/price/product?spm=a2c4g.11186623.2.1.fd0XwH#/oss/detail)。

    -   如果选择的域名类型为源站域名，并设置了一个OSS域名，则按照外网流量价格计费。

7.  单击 **确认**完成配置。


设置自定义端口

开通白名单后，您可以设置自定义端口。自定义端口支持范围：0-65535。

-   如果您的静态或动态协议设置为 **跟随** 时，无法设置自定义端口。
-   如果您通过OpenAPI设置回源协议为 **跟随**，请确保您的回源协议和自定义端口均能正常使用。
-   如果您通过端口设置了回源协议（HTTP或HTTPS）和自定义端口时，无论您在控制台如何设置，都将按照端口的配置进行回源。

