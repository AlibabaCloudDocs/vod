# 使用指南

## 简介

使用多应用前，请先通过多应用[概述](/cn.zh-CN/开发指南/多应用体系/概述.md)了解相关介绍和设定。如您已开通[点播服务](https://www.aliyun.com/product/vod)，则可按照如下步骤使用多应用：

![](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/113512/intl_zh/1554624186632/app.png)

## 申请开通

视频点播多应用体系处于公测期，点播控制台还未上线，满足以下条件的用户可进行申请：

-   近7天加速流量带宽峰值到达500Mbps及以上 [用量查询](https://vod.console.aliyun.com/#/usage/flow)

所以开通后会有以下影响：

-   不能禁用默认应用，否则会影响线上正常服务。
-   控制台上不能操作和查询除默认应用外的资源（媒资库、审核列表、媒体处理配置等）。
-   新创建的应用需要调用API重新创建转码配置、回调配置等。

**说明：** 如果是测试回调功能，可以通过上传时设置不同环境的回调地址来测试；如果是做媒资隔离，可以用媒资分类。

如果满足开通条件，且接受以上影响，请登录[申请页面](https://page.aliyun.com/form/act1652018117/index.htm) 提交相关信息，并[提交工单](https://selfservice.console.aliyun.com/ticket/category/vod/recommend/561) 到点播申请开通。

**说明：** 工单中，请**注明**已知晓多应用开通后的影响，可以接受，现申请开通多应用及**主账号 UID**。

## 创建应用

调用[创建应用](/cn.zh-CN/服务端API/多应用体系/应用管理/创建应用.md)接口创建应用（单个账号创建应用个数上限为10个，应用名称不能重复）。

**说明：** 首次必须使用[主账号AccessKey](https://usercenter.console.aliyun.com/#/manage/ak)才能创建应用，后续授予[RAM子账号](https://ram.console.aliyun.com/users)应用管理员权限后即可操作应用和授权。

## 为身份实体授权

调用[为身份实体附加应用授权](/cn.zh-CN/服务端API/多应用体系/授权管理/为身份实体附加应用授权.md)接口进行授权，授权后该身份实体（RAM子账号或角色）可以对应用下资源进行管理。权限策略请参考[应用授权](/cn.zh-CN/开发指南/多应用体系/概述.mdsection_ph1_mq5_qoh)。

## 使用多应用

支持多应用的服务，会增加对参数`AppId`的支持，创建资源或新的设置时可指定此参数，查询数据时也仅会返回拥有权限的应用下的资源，而修改或删除时会校验相关权限。

当前，仅**消息回调**和**媒资服务（上传、播放和媒资管理）**支持多应用，其它服务会陆续支持，敬请期待。

## 消息回调

可为每个应用设置独立的消息回调方式和地址，配合以下API使用：

-   [设置回调接口](/cn.zh-CN/服务端API/全局配置/事件通知/设置事件通知配置.md)：指定`AppId`，可设置该应用下的消息回调；未指定时，则使用系统默认应用。

完成设置后，不同应用下上传的视频、图片等产生的[事件通知](/cn.zh-CN/开发指南/事件通知/使用说明.md)会根据其设置进行相应回调。 也可使用[获取回调事件列表接口](/cn.zh-CN/服务端API/全局配置/事件通知/查询事件通知配置.md)查询相关配置。

**说明：** 开启多应用后，控制台暂时只能管理默认应用的回调配置；后续会迭代升级支持不同应用的管理。

## 媒资服务

-   媒体上传：上传相关接口\(获取视频上传地址和凭证、获取图片上传地址和凭证等\)支持指定`AppId`, 前提是该账号实体拥有该应用的权限，无权限则无法上传，不指定应用ID则上传到系统默认应用。
-   音视频播放：只能获取到授权应用下的播放信息（播放凭证、播放地址等）。
-   修改删除：修改和删除媒资相关操作只能操作有权限的应用下的资源。
-   媒资查询：查询媒资详情接口，只能获取到有权限的应用下的媒资信息。批量查询时，只返回有权限的媒资数据，无权限的MediaId会放入NonExistMediaIds（字段名可能略有不同）。
-   媒资搜索：搜索时只返回有权限的应用下的媒资数据，搜索条件中可指定一个或多个`AppId`。

**说明：** 开启多应用后，控制台媒资库暂时只能管理授权应用下的媒体资源；后续会迭代升级支持不同应用的管理。

## 常见问题

## 多应用和RAM访问控制有什么区别？

-   RAM主要是权限分割和管理，但本质上资源都在账号维度；而多应用是要实现同一云账号下多个使用方的资源、数据的物理隔离。
-   多应用本身不做云账号的登录和验证，应用授权是云账号在RAM里授予点播完全权限\(AliyunVODFullAccess\)后的进一步细粒度的权限控制。多应用必须结合RAM使用才能实现真正的分权管理。

## 开通多应用后，是否会影响现有业务？

不会影响，点播服务会向下兼容，但数据会默认放到`系统默认应用`下，且主账号下的子账号或角色，若授予了点播权限，则会都拥有`系统默认应用`的权限。

## 可以将应用下的资源授权给第三方账号访问吗？

支持的，可以使用RAM角色进行跨账号授权来实现，详情请参见[跨云账号的资源授权](/cn.zh-CN/教程/跨阿里云账号的资源授权.md)。

## 每个应用能单独计费吗？

不支持。目前存储、域名等资源还未实现多个应用间的物理隔离，后续所有用量资源（如存储、域名、转码、AI处理等）实现隔离后，会支持每个应用单独计算用量和数据统计，但计费账单仍然会归属到账号下。

