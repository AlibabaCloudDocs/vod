# 使用多应用体系

使用多应用体系前，请先阅读概述了解相关介绍和设定，并开通点播服务。本文为您介绍使用多应用的步骤、注意事项和常见问题。

如您已开通[点播服务](https://www.aliyun.com/product/vod?spm=a2c4g.11186623.2.20.67e51a9e8NkYq1)，则可按照如下步骤使用多应用：

![流程图](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5430134061/p178538.png)

## 申请开通

-   申请条件

    视频点播多应用体系处于公测期，点播控制台还未上线，满足以下条件的用户可进行申请：

    近7天加速流量带宽峰值到达500Mbps及以上。查看流量带宽峰值，请参见[用量查询](https://vod.console.aliyun.com/?spm=a2c4g.11186623.2.22.67e51a9e8NkYq1#/usage/flow)。

-   开通后影响

    -   不能禁用默认应用，否则会影响线上正常服务。
    -   控制台上不能操作和查询除默认应用外的资源（媒资库、审核列表、媒体处理配置等）。
    -   新创建的应用需要调用API重新创建转码配置、回调配置等。
    **说明：**

    -   如果是测试回调功能，可以通过上传时设置不同环境的回调地址来测试；
    -   如果是做媒资隔离，可以用媒资分类。
-   开通方法

    如果满足开通条件，且接受以上影响，请登录[申请页面](https://page.aliyun.com/form/act1652018117/index.htm)，[提交工单](https://selfservice.console.aliyun.com/ticket/category/vod/recommend/561)。

    **说明：** 工单中，请注明“已知晓多应用开通后的影响，可以接受，现申请开通多应用”，以及**主账号UID**。


## 创建应用

调用[创建应用](/cn.zh-CN/服务端API/多应用体系/应用管理/创建应用.md)接口创建应用（单个账号创建应用个数上限为10个，应用名称不能重复）。

**说明：** 首次创建必须使用主账号AccessKey才能创建应用，后续授予RAM用户应用管理员权限后即可操作应用和授权。

## 为身份实体授权

调用[为身份实体附加应用授权](/cn.zh-CN/服务端API/多应用体系/授权管理/为身份实体附加应用授权.md)接口进行授权，授权后该身份实体（RAM用户或角色）可以对应用下资源进行管理。权限策略请参见[权限策略](/cn.zh-CN/开发指南/多应用体系/概述.md)。

## 使用多应用

支持多应用的服务，会增加对参数`AppId`的支持，创建资源或新的设置时可指定此参数，查询数据时也仅会返回拥有权限的应用下的资源，而修改或删除时会校验相关权限。

当前，仅**消息回调**和**媒资服务（上传、播放和媒资管理）**支持多应用，其它服务会陆续支持，敬请期待。

-   消息回调

    可为每个应用设置独立的消息回调方式和地址，配合以下API使用：

    [设置事件通知配置](/cn.zh-CN/服务端API/全局配置/事件通知/设置事件通知配置.md)：

    -   指定AppId，可设置该应用下的消息回调；
    -   未指定时，则使用系统默认应用。
    完成设置后，不同应用下上传的视频、图片等产生的事件通知会根据其设置进行相应回调。也可使用[查询事件通知配置](/cn.zh-CN/服务端API/全局配置/事件通知/查询事件通知配置.md)接口查询相关配置。

    **说明：** 开启多应用后，控制台暂时只能管理默认应用的回调配置；后续会迭代升级支持不同应用的管理。

-   媒资服务

    -   媒体上传：上传相关接口\(获取视频上传地址和凭证、获取图片上传地址和凭证等\)支持指定AppId, 前提是该账号实体拥有该应用的权限，无权限则无法上传，不指定应用ID则上传到系统默认应用。
    -   音视频播放：只能获取到授权应用下的播放信息（播放凭证、播放地址等）。
    -   修改删除：修改和删除媒资相关操作只能操作有权限的应用下的资源。
    -   媒资查询：查询媒资详情接口，只能获取到有权限的应用下的媒资信息。批量查询时，只返回有权限的媒资数据，无权限的MediaId会放入NonExistMediaIds（字段名可能略有不同）。
    -   媒资搜索：搜索时只返回有权限的应用下的媒资数据，搜索条件中可指定一个或多个AppId。
    **说明：** 开启多应用后，控制台媒资库暂时只能管理授权应用下的媒体资源；后续会迭代升级支持不同应用的管理。


