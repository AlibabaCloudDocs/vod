下载媒体文件 
===========================

视频点播支持将存储在视频点播里的媒体文件下载到本地磁盘或其它存储上，提供了控制台、客户端和接口用于查询各种媒体文件的下载地址。本文为您介绍媒体文件、下载地址类型、下载限制和获取方法。

媒体文件 
-------------------------

使用视频点播服务时可能会产生多种可下载的媒体文件，包括源文件、转码输出的流文件、视频截图文件、上传的图片文件等，视频点播提供了各种媒体文件的查询和下载。媒体文件的分类如下：

* 音视频

  * 源文件：上传至点播的音视频源文件；

    
  
  * 转码输出文件：下载转码输出的流文件（某个清晰度）。

    
  

  

* 图片

  * 上传至点播的图片文件；

    
  
  * 经视频点播自动截图处理后生成的图片文件（封面截图和雪碧图）；

    
  
  * [提交媒体截图作业](/cn.zh-CN/服务端API/媒体处理/发起处理/提交媒体截图作业.md)后生成的图片文件（普通截图、雪碧图和组成雪碧图的原始小图）。

    
  

  




下载地址类型 
---------------------------

获取的媒体文件下载地址，一般为OSS源站地址或CDN加速地址，前者会产生[媒资管理（存储）](https://www.aliyun.com/price/detail/vod#module3)费用，即OSS外网流出流量的费用；后者会产生CDN流量费用，即[视频加速（CDN）](https://www.aliyun.com/price/product?#/cdn/detail)的费用。

* 存储地址

  * 未配置CDN加速域名时，各媒体文件的下载地址统一为存储地址。存储地址更多信息，请参见[存储管理](/cn.zh-CN/控制台指南/配置管理/存储管理.md)。

    
  
  * 配置CDN加速域名时，各媒体文件的下载地址统一为CDN加速地址。其中，源文件和转码输出文件下载地址支持强制返回源站地址，具体参考文档[获取源文件信息](/cn.zh-CN/服务端API/媒资管理/音视频管理/获取源文件信息.md)和[获取视频播放地址](/cn.zh-CN/服务端API/音视频播放/获取视频播放地址.md)，调用以上接口时，需要设置`OutputType`值为`oss`。当您的视频存储地址为输入bucket时（bucket名称以`in-`开头），配置CDN加速域名的情况下，源文件下载地址仍然为存储地址。

    
  

  

* 加速地址

  当您在点播配置了CDN加速域名后，各媒体文件的下载地址为CDN加速地址。配置CDN加速域名具体操作，请参见[域名管理](/cn.zh-CN/控制台指南/域名管理/添加加速域名.md)。
  




下载限制 
-------------------------

如果使用了防盗链配置、视频加密等功能，即便获取到媒体文件的下载地址，在下载媒体时仍可能受到同样的限制。

* 配置了[访问限制](/cn.zh-CN/开发指南/视频安全/访问限制.md)时，通过CDN加速地址下载，会受到配置的Refer防盗链、IP黑名单等策略的限制，与在线播放相同；通过OSS源站地址下载，则不受此限制；

  

* 使用视频加密，不管通过哪种方式下载，得到的转码输出的文件仍然为加密文件，需要解密后进行播放。更多信息，请参见[概述-视频加密](/cn.zh-CN/开发指南/视频安全/概述.md)；

  

* OSS存储如设置私有，则地址存在时效性，下载时要注意可能会过期，此时需要重新获取，建议设置较长有效期；

  

* CDN加速域名如开启了URL鉴权，则地址会在一段时间后过期，此时需要重新获取，建议设置较长有效期。

  




通过控制台获取下载地址 
--------------------------------

* 查看

  * 音视频源文件和转码输出文件下载地址：

    在 **[点播控制台\>媒资库\>音视频](https://vod.console.aliyun.com/#/media/video/list)** 页面，单击要查看的文件右侧的 **管理** 。![查看](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1380685061/p180272.png)

    在 **视频地址** 页面中单击 **复制地址** ，即可复制文件的下载地址；支持复制原文件和各个清晰度的转码输出文件的下载地址。![复制地址](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1380685061/p180274.png)
    
  
  * 上传至点播的图片文件下载地址：

    在 **[点播控制台\>媒资库\>图片](https://vod.console.aliyun.com/#/media/image/list)** 页面，单击要查看的文件右侧的 **管理。** ![管理](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1380685061/p180276.png)
    
  
  * 在 **图片详情** 页面中，单击 **复制** ，即可复制图片链接。![复制](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1380685061/p180279.png)

    
  

  

* 导出

  * 音视频转码输出文件：

    在 **[点播控制台\>媒资库\>音视频](https://vod.console.aliyun.com/#/media/video/list)** 页面，通过单击右上角![导出媒体地址](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2380685061/p180280.png)图标导出媒体地址，获取当前筛选条件下的前200条音视频对应的转码输出文件下载地址（各个清晰度）。
    
  
  * 上传至点播的图片文件：

    在 **[点播控制台\>媒资库\>图片](https://vod.console.aliyun.com/#/media/image/list)** 页面，通过单击右上角![导出媒体地址](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2380685061/p180280.png)图标导出媒体地址，获取当前筛选条件下的前100条图片对应的文件下载地址。
    
  

  




通过API/SDK获取下载地址 
------------------------------------

媒体文件下载包括下载音视频源文件、下载音视频流、下载自动截图文件、下载图片文件。您可以通过以下接口获取到相应的文件地址进行下载。


| 获取信息  |                                                                                                                                                描述                                                                                                                                                |                               参考文档                                |
|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
| 源文件地址 | 返回结果[Mezzanine](/cn.zh-CN/服务端API/附录/基本数据类型.md)对象中的`FileURL`字段为源文件地址。                                                                                                                                                                                                             | [获取源文件信息](/cn.zh-CN/服务端API/媒资管理/音视频管理/获取源文件信息.md) |
| 播放信息  | 返回结果[PlayInfo](/cn.zh-CN/服务端API/附录/基本数据类型.md)对象中的`PlayURL`字段为转码输出流地址。                                                                                                                                                                                                            | [获取视频播放地址](/cn.zh-CN/服务端API/音视频播放/获取视频播放地址.md)    |
| 视频信息  | 返回结果[Video](/cn.zh-CN/服务端API/附录/基本数据类型.md)对象中的`CoverURL`字段为封面地址，`Snapshots`字段为自动截图处理后截图地址数组。                                                                                                                                                                                     | [获取视频信息](/cn.zh-CN/服务端API/媒资管理/音视频管理/获取视频信息.md)   |
| 图片信息  | 返回结果[ImageInfo](/cn.zh-CN/服务端API/附录/基本数据类型.md)对象中的`URL`字段为图片地址。                                                                                                                                                                                                                  | [获取图片信息](/cn.zh-CN/服务端API/媒资管理/图片管理/获取图片信息.md)    |
| 媒资信息  | 媒资类型为音视频时，返回结果[Video](/cn.zh-CN/服务端API/附录/媒资搜索协议.md)和[Audio](/cn.zh-CN/服务端API/附录/媒资搜索协议.md)对象中的`CoverURL`字段为封面地址，`Snapshots`字段为视频截图地址数组，`SpriteSnapshots`字段为自动截图处理后的雪碧图地址数组；媒资类型为图片时，返回结果[Image](/cn.zh-CN/服务端API/附录/媒资搜索协议.md)对象中的`URL`字段为图片地址。 | [搜索媒体信息](/cn.zh-CN/服务端API/媒资管理/媒资搜索/搜索媒资信息.md)    |
| 截图数据  | 返回结果[MediaSnapshot](/cn.zh-CN/服务端API/附录/基本数据类型.md)对象中的`Snapshots`字段为与`SnapshotType`（截图类型）)对应的截图地址数组。                                                                                                                                                                             | [查询截图数据](/cn.zh-CN/服务端API/媒资管理/图片管理/查询截图数据.md)    |



**调用方式：** 

* 推荐使用服务端SDK调用API来获取媒资信息，更为简单、高效。服务端SDK请参见[使用说用](/cn.zh-CN/服务端SDK/使用说明.md)，API详情可参考各API文档的`SDK示例`。

  

* 您也可以参考[公共参数](/cn.zh-CN/服务端API/调用方式/公共参数.md)和[调用示例](/cn.zh-CN/服务端API/调用方式/调用示例.md)，来生成HTTP/HTTPS请求。

  




客户端下载 
--------------------------

针对移动端的使用场景，阿里云播放器SDK提供了 **离线下载** 功能，您可以根据业务需要，通过启用下载功能，允许终端用户将音视频流文件缓存至本地进行观看。离线下载提供两种下载方式------普通下载和安全下载。

**下载设置** 

您可以在控制台的 **[下载设置](https://vod.console.aliyun.com/#/settings/download)** 页面中设置离线下载的方式。具体操作，请参见[下载设置](/cn.zh-CN/控制台指南/域名管理/下载设置.md)。

* 普通下载的音视频文件不会被加密，可拷贝，也可使用任意播放器播放，请谨慎使用。

  

* 安全下载的音视频文件会使用生成的密钥文件进行加解密，保障视频安全。需要使用阿里云播放器SDK完成解密播放，点播控制台提供了加密私钥的生成工具。

  




**播放器SDK** 

iOS和Android播放器SDK同时支持客户端下载和缓存功能，具体操作，请参见iOS播放器[功能使用](/cn.zh-CN/播放器SDK/iOS播放器/功能使用.md)和Android播放器[功能使用](/cn.zh-CN/播放器SDK/Android播放器/功能使用.md)。
